{"version":3,"sources":["webpack:///src/app/invoice/invoice.component.ts","webpack:///src/app/invoice/invoice.component.html","webpack:///src/app/invoice/add-vehicle-dialog/add-vehicle-dialog.component.html","webpack:///src/app/invoice/add-vehicle-dialog/add-vehicle-dialog.component.ts","webpack:///src/app/invoice/bill-to-dialog/bill-to-dialog.component.html","webpack:///src/app/invoice/bill-to-dialog/bill-to-dialog.component.ts","webpack:///src/app/invoice/edit-vehicle-dialog/edit-vehicle-dialog.component.html","webpack:///src/app/invoice/edit-vehicle-dialog/edit-vehicle-dialog.component.ts","webpack:///src/app/invoice/new-invoice-dialog/new-invoice-dialog.component.html","webpack:///src/app/invoice/new-invoice-dialog/new-invoice-dialog.component.ts","webpack:///src/app/invoice/edit-invoice-dialog/edit-invoice-dialog.component.html","webpack:///src/app/invoice/edit-invoice-dialog/edit-invoice-dialog.component.ts","webpack:///src/app/business/services/invoice.service.ts","webpack:///src/app/invoice/invoice.module.ts","webpack:///src/app/invoice/ship-select-dialog/ship-select-dialog.component.html","webpack:///src/app/invoice/ship-select-dialog/ship-select-dialog.component.ts"],"names":["InvoiceComponent","dialog","dialogService","invoiceService","invoiceState","notificationService","authService","paginatorPageIndex","paginatorPageSize","subscriptions","displayedColumns","pageSizeOptions","tab","newInvoiceCurrentStep","selectedInvoices","allSelected","isAdmin","items","sub","invoices$","subscribe","data","setAllSelectedInvoices","invoices","sub2","selectedInvoices$","push","handleFetchInvoices","filterPredicate","filter","driver","first_name","toLowerCase","indexOf","last_name","number","toString","bill_to","name","ship_from","quick_ship_from","ship_to","quick_ship_to","total","sortingDataAccessor","item","property","Date","date","sort","e","console","log","pageSize","pageIndex","type","showLoader","fetchInvoices","then","paginatorLength","totalResults","hideLoader","invoice","setSelectedInvoice","openEditDialog","closeAll","open","width","disableClose","onBillTo","openBillToDialog","onShipFrom","openShipSelectDialog","onShipTo","onAddVehicle","openAddVehicleDialog","onEditVehicle","vehicle","openEditVehicleDialog","onDeleteVehicle","showConfirm","title","msg","deleteNewInvoiceVehicle","_id","currentStep","setCurrentStep","idx","deleteSelectedInvoiceVehicle","action","onBackToInvoice","openNewDialog","viewMode","deleteInvoice","id","res","success","setSelectedInvoices","target","checked","filteredData","length","some","inv","status","invoiceIds","map","submitDraftInvoices","err","error","submitInvoicesToQB","warning","submitInvoicesToPaid","exportToPdf","filterValue","trim","toLocaleLowerCase","forEach","unsubscribe","applyFilter","onExportPdf","setTable","handlePage","selector","templateUrl","styleUrls","paginator","table","AddVehicleDialogComponent","dialogRef","fb","vehicleService","invoicesState","rateService","years","makes","models","buildForm","selectedInvoice$","selectedInvoice","rates","currentShipFromCity","city","currentShipToCity","rate","find","rt","origination_city","state_code","destination_city","amount","vehicleForm","controls","setValue","value","fetchRates","event","getModelsByMake","model","group","vin","required","pattern","year","make","weight","comments","valid","searchVin","toUpperCase","vehicleSearched","setErrors","faliedSearch","markAsTouched","vinControl","invalid","Object","values","control","addSelectedInvoiceVehicle","addNewInvoiceVehicle","message","onSubmit","onSearchVin","onSelectYear","onSelectMake","BillToDialogComponent","customerService","foundCustomers","mostRecentsCustomers","mostRecentsCustomers$","query","searchCustomers","customer","setNewInvoice","backToInvoice","EditVehicleDialogComponent","currentRate$","getModels","disabled","editSelectedInvoiceVehicle","editNewInvoiceVehicle","statuses","label","NewInvoiceDialogComponent","userService","isLoading","sub1","users","drivers","newInvoice$","fetchUsers","getMostRecents","setMostRecentsCustomers","d","selectedIndex","from","to","code","getRateByCode","setCurretRate","subtotal","vehicles","v","Number","getSubTotal","driverCommission","commission","body","driver_id","rest","saveInvoice","close","resetNewInvoice","onSelectDriver","onSelectStatus","onCancel","EditInvoiceDialogComponent","updateInvoice","resetSelectedInvoice","InvoiceService","http","baseUrl","apiUrl","limit","page","Promise","resolve","reject","url","get","setInvoices","results","post","pipe","invoiceId","put","responseType","blob","Blob","window","URL","createObjectURL","link","document","createElement","href","setAttribute","appendChild","click","providedIn","routes","path","component","InvoiceModule","forChild","declarations","imports","ShipSelectDialogComponent","geoService","showQuickEntry","states","cities","currentCities","currentCity","customerForm","city_id","reset","selectedState","c","handleEditQuickEntry","sub3","fetchCitiesByState","isQuickEntry","setInvoice","isFrom","blur","selectedCity","state","state_name","onSelect","onQuickEntry"],"mappings":"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","file":"invoice-invoice-module-es5.js","sourcesContent":["import { AfterContentInit, AfterViewInit, Component, DoCheck, OnDestroy, OnInit, ViewChild } from '@angular/core'\nimport { MatDialog } from '@angular/material/dialog'\nimport { MatPaginator } from '@angular/material/paginator'\nimport { MatSort } from '@angular/material/sort'\nimport { MatTable, MatTableDataSource } from '@angular/material/table'\nimport { Subscription } from 'rxjs'\nimport { InvoiceService } from '../business/services/invoice.service'\nimport { Invoice, InvoiceStatus } from '../business/models/invoice.models'\nimport { DialogService } from '../shared/dialogs/dialog.service'\nimport { AddVehicleDialogComponent, AddVehicleDialogData } from './add-vehicle-dialog/add-vehicle-dialog.component'\nimport { BillToDialogComponent, BillToDialogData } from './bill-to-dialog/bill-to-dialog.component'\nimport { NewInvoiceDialogComponent, NewInvoiceDialogData } from './new-invoice-dialog/new-invoice-dialog.component'\nimport { ShipSelectDialogComponent, ShipSelectDialogData } from './ship-select-dialog/ship-select-dialog.component'\nimport { InvoicesStateService } from '../business/state/invoice-state.service'\nimport { NotificationService } from '../shared/notifications/notification.service'\nimport { EditInvoiceDialogComponent, EditInvoiceDialogData } from './edit-invoice-dialog/edit-invoice-dialog.component'\nimport { EditVehicleDialogComponent, EditVehicleDialogData } from './edit-vehicle-dialog/edit-vehicle-dialog.component'\nimport { Vehicle } from '../business/models/vehicle.models'\nimport { AuthenticationService } from '../authentication/authentication.service'\n\n@Component({\n  selector: 'app-invoice',\n  templateUrl: './invoice.component.html',\n  styleUrls: ['./invoice.component.scss'],\n})\nexport class InvoiceComponent implements OnInit, AfterViewInit, OnDestroy {\n  @ViewChild(MatSort, { static: true }) sort: MatSort\n  @ViewChild(MatPaginator) paginator: MatPaginator\n  @ViewChild('table', { static: true }) table: MatTable<any>\n\n  auxPaginator: MatPaginator\n  paginatorPageIndex: number = 1\n  paginatorLength: number\n  paginatorPageSize: number = 12\n\n  subscriptions: Subscription[] = []\n  displayedColumns = ['_', 'driver', 'invoice_number', 'date', 'bill_to', 'ship_from', 'ship_to', 'amount', 'actions']\n  pageSizeOptions: number[] = [12, 24, 50, 100]\n  items: MatTableDataSource<any>\n  invoices: Invoice[]\n  tab: InvoiceStatus = 'DRAFT'\n  newInvoiceCurrentStep: 0 | 1 = 0\n  selectedInvoices: Invoice[] = []\n  allSelected = false\n  isAdmin: boolean\n\n  constructor(\n    public dialog: MatDialog,\n    private dialogService: DialogService,\n    private invoiceService: InvoiceService,\n    public invoiceState: InvoicesStateService,\n    private notificationService: NotificationService,\n    private authService: AuthenticationService\n  ) {\n    this.isAdmin = this.authService.isAdmin()\n    this.items = new MatTableDataSource([])\n    const sub = invoiceState.invoices$.subscribe((data) => {\n      this.allSelected = false\n      this.invoiceState.setAllSelectedInvoices([], false)\n      this.invoices = data\n      this.items.data = this.invoices\n    })\n    const sub2 = invoiceState.selectedInvoices$.subscribe((data) => {\n      this.selectedInvoices = data\n    })\n\n    this.subscriptions.push(sub, sub2)\n  }\n\n  ngOnInit() {\n    this.handleFetchInvoices(this.tab, this.paginatorPageSize, this.paginatorPageIndex)\n\n    //custom table filters\n    this.items.filterPredicate = (data: Invoice, filter: string) => {\n      return (\n        data.driver.first_name.toLowerCase().indexOf(filter) !== -1 ||\n        data.driver.last_name.toLowerCase().indexOf(filter) !== -1 ||\n        data.number?.toString().toLowerCase().indexOf(filter) !== -1 ||\n        data.bill_to?.name.toLowerCase().indexOf(filter) !== -1 ||\n        (data.ship_from || data.quick_ship_from)?.name.toLowerCase().indexOf(filter) !== -1 ||\n        (data.ship_to || data.quick_ship_to)?.name.toLowerCase().indexOf(filter) !== -1 ||\n        data.total.toString().toLowerCase().indexOf(filter) !== -1\n      )\n    }\n\n    //custom table sort\n    this.items.sortingDataAccessor = (item, property) => {\n      switch (property) {\n        case 'invoice_number':\n          return item.number\n        case 'date':\n          return new Date(item.date)\n        case 'driver':\n          return item.driver?.first_name + ' ' + item.driver?.last_name\n        default:\n          return item[property]\n      }\n    }\n    this.items.sort = this.sort\n  }\n\n  handlePage(e: any) {\n    console.log(e)\n    this.paginatorPageSize = e.pageSize\n    this.handleFetchInvoices(this.tab, e.pageSize, e.pageIndex + 1)\n  }\n\n  setTable(type: InvoiceStatus) {\n    this.paginatorPageIndex = 1\n    this.allSelected = false\n    this.invoiceState.setAllSelectedInvoices([], false)\n    this.tab = type\n    this.items.data = []\n    this.handleFetchInvoices(type, this.paginatorPageSize, this.paginatorPageIndex)\n  }\n\n  handleFetchInvoices(type: InvoiceStatus, pageSize: number, pageIndex: number) {\n    this.dialogService.showLoader()\n    this.invoiceService\n      .fetchInvoices(type, pageSize, pageIndex)\n      .then((data) => {\n        this.paginatorLength = data.totalResults\n      })\n      .finally(() => {\n        this.dialogService.hideLoader()\n      })\n  }\n\n  // setInvoices() {\n  //   this.items.data = this.invoices.filter((inv) => inv.status === this.tab)\n  // }\n\n  onEdit(invoice: Invoice) {\n    this.invoiceState.setSelectedInvoice(invoice)\n    this.openEditDialog()\n  }\n\n  openNewDialog() {\n    this.dialog.closeAll()\n    this.dialog.open<NewInvoiceDialogComponent, NewInvoiceDialogData>(NewInvoiceDialogComponent, {\n      width: '800px',\n      disableClose: true,\n      data: {\n        onBillTo: () => this.openBillToDialog(),\n        onShipFrom: () => this.openShipSelectDialog('FROM'),\n        onShipTo: () => this.openShipSelectDialog('TO'),\n        onAddVehicle: () => this.openAddVehicleDialog(),\n        onEditVehicle: (vehicle: Vehicle) => this.openEditVehicleDialog(vehicle),\n        onDeleteVehicle: (vehicle: Vehicle) =>\n          this.dialogService.showConfirm({ title: 'Delete vehicle', msg: 'Are you sure?' }, () => {\n            this.invoiceState.deleteNewInvoiceVehicle(vehicle._id)\n          }),\n        currentStep: this.newInvoiceCurrentStep,\n        setCurrentStep: (idx: 0 | 1) => {\n          this.newInvoiceCurrentStep = idx\n        },\n      },\n    })\n  }\n\n  openEditDialog() {\n    this.dialog.closeAll()\n    this.dialog.open<EditInvoiceDialogComponent, EditInvoiceDialogData>(EditInvoiceDialogComponent, {\n      width: '800px',\n      disableClose: true,\n      data: {\n        onBillTo: () => this.openBillToDialog('edit'),\n        onShipFrom: () => this.openShipSelectDialog('FROM', 'edit'),\n        onShipTo: () => this.openShipSelectDialog('TO', 'edit'),\n        onAddVehicle: () => this.openAddVehicleDialog('edit'),\n        onEditVehicle: (vehicle: Vehicle) => this.openEditVehicleDialog(vehicle, 'edit'),\n        onDeleteVehicle: (vehicle: Vehicle) =>\n          this.dialogService.showConfirm({ title: 'Delete vehicle', msg: 'Are you sure?' }, () => {\n            this.invoiceState.deleteSelectedInvoiceVehicle(vehicle._id)\n          }),\n        currentStep: this.newInvoiceCurrentStep,\n        setCurrentStep: (idx: 0 | 1) => {\n          this.newInvoiceCurrentStep = idx\n        },\n      },\n    })\n  }\n\n  openBillToDialog(action: 'edit' | 'new' = 'new') {\n    this.dialog.closeAll()\n    this.dialog.open<BillToDialogComponent, BillToDialogData>(BillToDialogComponent, {\n      width: '700px',\n      disableClose: true,\n      data: {\n        action,\n        onBackToInvoice: () => (action === 'edit' ? this.openEditDialog() : this.openNewDialog()),\n      },\n    })\n  }\n\n  openShipSelectDialog(type: 'FROM' | 'TO', action: 'edit' | 'new' = 'new') {\n    this.dialog.closeAll()\n    this.dialog.open<ShipSelectDialogComponent, ShipSelectDialogData>(ShipSelectDialogComponent, {\n      width: '700px',\n      disableClose: true,\n      data: {\n        onBackToInvoice: () => (action === 'edit' ? this.openEditDialog() : this.openNewDialog()),\n        //onCustomerQuickEntry: () => this.openCustomerQuickEntryDialog(),\n        type,\n        action,\n      },\n    })\n  }\n\n  openAddVehicleDialog(action: 'edit' | 'new' = 'new') {\n    this.dialog.closeAll()\n    this.dialog.open<AddVehicleDialogComponent, AddVehicleDialogData>(AddVehicleDialogComponent, {\n      width: '700px',\n      disableClose: true,\n      data: {\n        action,\n        onBackToInvoice: () => (action === 'edit' ? this.openEditDialog() : this.openNewDialog()),\n      },\n    })\n  }\n\n  openEditVehicleDialog(vehicle: Vehicle, action: 'edit' | 'new' = 'new') {\n    this.dialog.closeAll()\n    this.dialog.open<EditVehicleDialogComponent, EditVehicleDialogData>(EditVehicleDialogComponent, {\n      width: '700px',\n      disableClose: true,\n      data: {\n        action,\n        onBackToInvoice: () => (action === 'edit' ? this.openEditDialog() : this.openNewDialog()),\n        vehicle,\n        viewMode: this.tab != 'DRAFT' && this.tab != 'SUBMITTED_FOR_REVIEW',\n      },\n    })\n  }\n\n  onDelete(invoice: Invoice) {\n    this.dialogService.showConfirm({ title: 'Delete invoice', msg: 'Are you sure?' }, () => {\n      this.invoiceService.deleteInvoice(invoice.id).subscribe((res) => {\n        this.notificationService.success('Invoice deleted')\n      })\n    })\n  }\n\n  onSelectInvoice(e: any, invoice: Invoice) {\n    this.allSelected = false\n    this.invoiceState.setSelectedInvoices(invoice, e.target.checked)\n  }\n\n  onSelectAll(e: any) {\n    this.allSelected = true\n    this.invoiceState.setAllSelectedInvoices(this.items.filteredData, e.target.checked)\n  }\n\n  onSubmitToReview() {\n    if (!this.selectedInvoices?.length || this.selectedInvoices.some((inv) => inv.status !== 'DRAFT')) return\n    const invoiceIds = this.selectedInvoices.map((inv) => inv.id)\n    this.dialogService.showLoader()\n\n    this.invoiceService.submitDraftInvoices(invoiceIds).subscribe(\n      (res) => {\n        this.notificationService.success('Invoices submitted')\n        this.dialogService.hideLoader()\n      },\n      (err) => {\n        this.notificationService.error()\n        this.dialogService.hideLoader()\n      }\n    )\n  }\n\n  onSubmitToQB() {\n    if (!this.selectedInvoices?.length || this.selectedInvoices.some((inv) => inv.status !== 'SUBMITTED_FOR_REVIEW')) {\n      return\n    }\n    const invoiceIds = this.selectedInvoices.map((inv) => inv.id)\n    this.dialogService.showLoader()\n    this.invoiceService.submitInvoicesToQB(invoiceIds).subscribe(\n      (res: any) => {\n        if (res.status === 'warning') {\n          return this.notificationService.warning(res.msg)\n        }\n        this.notificationService.success('Invoices submitted')\n        this.dialogService.hideLoader()\n      },\n      (err) => {\n        this.notificationService.error()\n        this.dialogService.hideLoader()\n      }\n    )\n  }\n\n  onSubmitToPaid() {\n    if (!this.selectedInvoices?.length || this.selectedInvoices.some((inv) => inv.status !== 'SUBMITTED_TO_CUSTOMER'))\n      return\n    const invoiceIds = this.selectedInvoices.map((inv) => inv.id)\n    this.dialogService.showLoader()\n    this.invoiceService.submitInvoicesToPaid(invoiceIds).subscribe(\n      (res: any) => {\n        // if (res.status === \"warning\") {\n        //   return this.notificationService.warning(res.msg);\n        // }\n        this.notificationService.success('Invoices submitted')\n        this.dialogService.hideLoader()\n      },\n      (err) => {\n        this.notificationService.error()\n        this.dialogService.hideLoader()\n      }\n    )\n  }\n\n  onExportPdf() {\n    this.dialogService.showLoader()\n    this.invoiceService\n      .exportToPdf(this.selectedInvoices)\n      .catch(() => {\n        this.notificationService.error()\n      })\n      .finally(() => {\n        this.dialogService.hideLoader()\n      })\n  }\n\n  ngAfterViewInit() {\n    this.items.sort = this.sort\n    //this.items.paginator = this.paginator\n  }\n\n  applyFilter(filterValue: string) {\n    this.allSelected = false\n    this.invoiceState.setAllSelectedInvoices([], false)\n    this.items.filter = filterValue.trim().toLocaleLowerCase()\n  }\n\n  ngOnDestroy() {\n    this.subscriptions.forEach((sub) => sub.unsubscribe())\n  }\n}\n","<div class=\"px-2 px-md-5 py-3\">\n  <!-- content topbar -->\n  <div class=\"d-flex flex-wrap w-100 justify-content-between align-items-center mb-3\">\n    <h1 class=\"text-dark d-inline-block content-title\">Invoices</h1>\n    <div class=\"d-flex content-options-bar\">\n      <div class=\"input-group\">\n        <div class=\"input-group-prepend\">\n          <span class=\"input-group-text\">\n            <i class=\"fas fa-search\"></i>\n          </span>\n        </div>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          (keyup)=\"applyFilter($event.target.value)\"\n          placeholder=\"Filter by any field...\"\n        />\n      </div>\n      <button (click)=\"openNewDialog()\" class=\"btn font-weight-bold bg-blue-main text-light ml-3\" [disabled]=\"!isAdmin\">\n        +Add\n      </button>\n      <div ngbDropdown class=\"d-inline-block ml-3\">\n        <button class=\"btn btn-outline-primary\" *ngIf=\"this.selectedInvoices?.length\" ngbDropdownToggle>Actions</button>\n        <div ngbDropdownMenu>\n          <button *ngIf=\"tab === 'DRAFT'\" ngbDropdownItem (click)=\"onSubmitToReview()\">\n            <i class=\"far fa-paper-plane mr-2\"></i>\n            <span>Submit for review</span>\n          </button>\n          <button *ngIf=\"tab === 'SUBMITTED_FOR_REVIEW'\" ngbDropdownItem (click)=\"onSubmitToQB()\">\n            <i class=\"far fa-paper-plane mr-2\"></i>\n            <span>Submit to QB</span>\n          </button>\n          <button *ngIf=\"tab === 'SUBMITTED_TO_CUSTOMER'\" ngbDropdownItem (click)=\"onSubmitToPaid()\">\n            <i class=\"far fa-paper-plane mr-2\"></i>\n            <span>Submit to Paid</span>\n          </button>\n          <button ngbDropdownItem (click)=\"onExportPdf()\">\n            <i class=\"far fa-file-alt mr-2\"></i>\n            <span>Export PDF</span>\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <!-- TABS NAV -->\n  <div class=\"nav-wrapper mb-4\">\n    <ul class=\"nav nav-pills nav-fill\">\n      <li class=\"nav-item cursor-pointer\" (click)=\"setTable('DRAFT')\">\n        <a class=\"nav-link\" [class.active]=\"tab === 'DRAFT'\">Driver drafts</a>\n      </li>\n      <li class=\"nav-item cursor-pointer\" (click)=\"setTable('SUBMITTED_FOR_REVIEW')\">\n        <a class=\"nav-link\" [class.active]=\"tab === 'SUBMITTED_FOR_REVIEW'\">Submitted for review</a>\n      </li>\n      <!-- <li class=\"nav-item cursor-pointer\" (click)=\"setTable('QUEUED_FOR_EXPORT')\">\n        <a class=\"nav-link\" [class.active]=\"tab === 'QUEUED_FOR_EXPORT'\">Queued for export</a>\n      </li> -->\n      <li class=\"nav-item cursor-pointer\" (click)=\"setTable('SUBMITTED_TO_CUSTOMER')\">\n        <a class=\"nav-link\" [class.active]=\"tab === 'SUBMITTED_TO_CUSTOMER'\">Submitted to customers</a>\n      </li>\n      <li class=\"nav-item cursor-pointer\" (click)=\"setTable('PAID')\">\n        <a class=\"nav-link\" [class.active]=\"tab === 'PAID'\">Paid</a>\n      </li>\n    </ul>\n  </div>\n\n  <!-- TABLE -->\n  <div class=\"row mb-4\">\n    <div class=\"col-12 table-wrapper table-responsive\">\n      <table mat-table [dataSource]=\"items\" class=\"table table-borderless table-striped\" matSort>\n        <ng-container matColumnDef=\"_\">\n          <th mat-header-cell *matHeaderCellDef>\n            <div class=\"custom-control custom-checkbox\" (change)=\"onSelectAll($event)\">\n              <input id=\"all-check\" type=\"checkbox\" class=\"custom-control-input\" [checked]=\"allSelected\" />\n              <label for=\"all-check\" class=\"custom-control-label\"></label>\n            </div>\n          </th>\n          <td mat-cell *matCellDef=\"let invoice\">\n            <div class=\"custom-control custom-checkbox\">\n              <input\n                type=\"checkbox\"\n                class=\"custom-control-input\"\n                [id]=\"invoice.id\"\n                [checked]=\"selectedInvoices.includes(invoice)\"\n                (change)=\"onSelectInvoice($event, invoice)\"\n              />\n              <label class=\"custom-control-label\" [for]=\"invoice.id\"></label>\n            </div>\n          </td>\n        </ng-container>\n\n        <ng-container matColumnDef=\"driver\">\n          <th mat-header-cell *matHeaderCellDef mat-sort-header>Driver</th>\n          <td mat-cell *matCellDef=\"let invoice\" class=\"capitalize\">\n            {{ invoice.driver?.first_name }} {{ invoice.driver?.last_name }}\n          </td>\n        </ng-container>\n\n        <ng-container matColumnDef=\"invoice_number\">\n          <th mat-header-cell *matHeaderCellDef mat-sort-header style=\"white-space: nowrap\">Invoice #</th>\n          <td mat-cell *matCellDef=\"let invoice\">{{ invoice.number }}</td>\n        </ng-container>\n\n        <ng-container matColumnDef=\"date\">\n          <th mat-header-cell *matHeaderCellDef mat-sort-header>Date</th>\n          <td mat-cell *matCellDef=\"let invoice\">{{ invoice.date | date: 'MM/dd/yyyy' }}</td>\n        </ng-container>\n\n        <ng-container matColumnDef=\"bill_to\">\n          <th mat-header-cell *matHeaderCellDef>Bill to</th>\n          <td mat-cell *matCellDef=\"let invoice\" style=\"min-width: 155px\">\n            {{ invoice.bill_to?.name }} <br />\n            {{ invoice.bill_to?.city?.name }}, {{ invoice.bill_to?.city?.state_code }}\n          </td>\n        </ng-container>\n\n        <ng-container matColumnDef=\"ship_from\">\n          <th mat-header-cell *matHeaderCellDef>Ship from</th>\n          <td mat-cell *matCellDef=\"let invoice\" style=\"min-width: 155px\">\n            {{ invoice.ship_from?.name || invoice.quick_ship_from?.name }} <br />\n            {{ invoice.ship_from?.city?.name || invoice.quick_ship_from?.city?.name }},\n            {{ invoice.ship_from?.city?.state_code || invoice.quick_ship_from?.city?.state_code }}\n          </td>\n        </ng-container>\n\n        <ng-container matColumnDef=\"ship_to\">\n          <th mat-header-cell *matHeaderCellDef>Ship to</th>\n          <td mat-cell *matCellDef=\"let invoice\" style=\"min-width: 155px\">\n            {{ invoice.ship_to?.name || invoice.quick_ship_to?.name }} <br />\n            {{ invoice.ship_to?.city?.name || invoice.quick_ship_to?.city?.name }},\n            {{ invoice.ship_to?.city?.state_code || invoice.quick_ship_to?.city?.state_code }}\n          </td>\n        </ng-container>\n\n        <ng-container matColumnDef=\"amount\">\n          <th mat-header-cell *matHeaderCellDef>Amount</th>\n          <td mat-cell *matCellDef=\"let invoice\">{{ invoice.total | currency }}</td>\n        </ng-container>\n\n        <ng-container matColumnDef=\"actions\">\n          <th mat-header-cell *matHeaderCellDef>Actions</th>\n          <td mat-cell *matCellDef=\"let invoice\">\n            <div *ngIf=\"tab == 'DRAFT' || tab == 'SUBMITTED_FOR_REVIEW'\" class=\"action-buttons\">\n              <button (click)=\"onEdit(invoice)\" class=\"text-dark mr-4\" aria-label=\"edit\">\n                <i class=\"fas fa-edit text-xl\"></i>\n              </button>\n              <button (click)=\"onDelete(invoice)\" class=\"text-dark\" aria-label=\"edit\">\n                <i class=\"fas fa-trash-alt text-xl\"></i>\n              </button>\n            </div>\n            <div *ngIf=\"tab != 'DRAFT' && tab != 'SUBMITTED_FOR_REVIEW'\" class=\"action-buttons justify-content-center\">\n              <button (click)=\"onEdit(invoice)\" class=\"text-dark mr-4\" aria-label=\"edit\">\n                <i class=\"fas fa-eye text-xl\"></i>\n              </button>\n            </div>\n          </td>\n        </ng-container>\n\n        <tr mat-header-row *matHeaderRowDef=\"displayedColumns\"></tr>\n        <tr mat-row *matRowDef=\"let row; columns: displayedColumns\"></tr>\n      </table>\n      <div *ngIf=\"!items.data.length || !items.filteredData.length\" class=\"table-width text-center border py-3 mt-n3\">\n        No invoices found\n      </div>\n      <mat-paginator\n        [length]=\"paginatorLength\"\n        [pageIndex]=\"paginatorPageIndex - 1\"\n        [pageSize]=\"paginatorPageSize\"\n        [pageSizeOptions]=\"pageSizeOptions\"\n        (page)=\"handlePage($event)\"\n        aria-label=\"Select page\"\n      ></mat-paginator>\n    </div>\n  </div>\n</div>\n","<h3>Add vehicle</h3>\n\n<form class=\"form-group\" [formGroup]=\"vehicleForm\" (ngSubmit)=\"onSubmit()\">\n  <div class=\"w-100 input-group pt-2 mb-3\">\n    <div class=\"input-group-prepend\">\n      <span class=\"input-group-text\">\n        <i class=\"fas fa-search\"></i>\n      </span>\n    </div>\n    <input\n      (input)=\"onSearchVin($event)\"\n      type=\"text\"\n      class=\"form-control\"\n      placeholder=\"Search VIN...\"\n      formControlName=\"vin\"\n      [class.is-invalid]=\"vehicleForm.controls.vin.touched && vehicleForm.controls.vin.invalid\"\n      [class.is-valid]=\"!!this.vehicleSearched\"\n    />\n    <div class=\"form-text invalid-feedback\" *ngIf=\"true\">\n      {{vehicleForm.controls.vin.errors?.faliedSearch ? \"VIN not found\" : \"Invalid VIN\" }}\n    </div>\n  </div>\n\n  <div class=\"w-100 mb-3\">\n    <label for=\"year\" class=\"text-dark text-base\">Year</label>\n    <div class=\"custom-select-wrapper\">\n      <select\n        class=\"custom-select form-control\"\n        formControlName=\"year\"\n        [class.is-invalid]=\"vehicleForm.controls.year.touched && vehicleForm.controls.year.invalid\"\n        (change)=\"onSelectYear($event)\"\n      >\n        <option disabled value=\"\">Select year...</option>\n        <option *ngFor=\"let year of years\" [value]=\"year\">{{ year }}</option>\n      </select>\n      <mat-icon class=\"half-arrow-icon\" svgIcon=\"half-arrow-down\"></mat-icon>\n    </div>\n  </div>\n\n  <div class=\"w-100 mb-3\">\n    <label for=\"make\" class=\"text-dark text-base\">Make</label>\n    <div class=\"custom-select-wrapper\">\n      <select\n        class=\"custom-select form-control\"\n        formControlName=\"make\"\n        [class.is-invalid]=\"vehicleForm.controls.make.touched && vehicleForm.controls.make.invalid\"\n        (change)=\"onSelectMake($event)\"\n      >\n        <option disabled value=\"\">Select make...</option>\n        <option *ngFor=\"let make of makes\" [value]=\"make\">{{ make }}</option>\n      </select>\n      <mat-icon class=\"half-arrow-icon\" svgIcon=\"half-arrow-down\"></mat-icon>\n    </div>\n  </div>\n\n  <div class=\"w-100 mb-3\">\n    <label for=\"model\" class=\"text-dark text-base\">Model</label>\n    <div class=\"custom-select-wrapper\">\n      <select\n        class=\"custom-select form-control\"\n        formControlName=\"model\"\n        [class.is-invalid]=\"vehicleForm.controls.model.touched && vehicleForm.controls.model.invalid\"\n      >\n        <option disabled value=\"\">Select model...</option>\n        <option *ngFor=\"let model of models\" [value]=\"model\">{{ model }}</option>\n      </select>\n      <mat-icon class=\"half-arrow-icon\" svgIcon=\"half-arrow-down\"></mat-icon>\n    </div>\n  </div>\n\n  <div class=\"w-100 mb-3\">\n    <label for=\"amount\" class=\"text-dark text-base\">Amount</label>\n    <div class=\"input-group\">\n      <div class=\"input-group-prepend\">\n        <span class=\"input-group-text\"> $ </span>\n      </div>\n      <input\n        type=\"number\"\n        class=\"form-control\"\n        placeholder=\"Amount...\"\n        formControlName=\"amount\"\n        [class.is-invalid]=\"vehicleForm.controls.amount.touched && vehicleForm.controls.amount.invalid\"\n      />\n    </div>\n  </div>\n\n  <div class=\"w-100 mb-3\">\n    <label for=\"weight\" class=\"text-dark text-base\">Weight</label>\n    <div class=\"input-group\">\n      <div class=\"input-group-prepend\">\n        <span class=\"input-group-text\"> Kg </span>\n      </div>\n      <input\n        type=\"number\"\n        class=\"form-control\"\n        placeholder=\"Weight...\"\n        formControlName=\"weight\"\n        [class.is-invalid]=\"vehicleForm.controls.weight.touched && vehicleForm.controls.weight.invalid\"\n      />\n    </div>\n  </div>\n\n  <div class=\"w-100\">\n    <label for=\"comments\" class=\"text-dark text-base\">Comments</label>\n    <textarea\n      class=\"form-control\"\n      id=\"textarea\"\n      maxlength=\"256\"\n      rows=\"3\"\n      formControlName=\"comments\"\n      [class.is-invalid]=\"vehicleForm.controls.comments.touched && vehicleForm.controls.comments.invalid\"\n    ></textarea>\n  </div>\n\n  <div class=\"d-flex w-100 px-4 pt-3 justify-content-between mt-3\">\n    <div class=\"col-5\">\n      <button class=\"btn w-100 btn-outline-secondary\" type=\"button\" (click)=\"data.onBackToInvoice()\">Cancel</button>\n    </div>\n    <div class=\"col-5\">\n      <button class=\"btn w-100 btn-success\">Add</button>\n    </div>\n  </div>\n</form>\n","import { Component, Inject, OnDestroy, OnInit } from \"@angular/core\";\nimport { FormBuilder, FormGroup, Validators } from \"@angular/forms\";\nimport { MatDialogRef, MAT_DIALOG_DATA } from \"@angular/material/dialog\";\nimport { Subscription } from \"rxjs\";\nimport { Invoice } from \"src/app/business/models/invoice.models\";\nimport { Rate } from \"src/app/business/models/rate.models\";\nimport { VinData } from \"src/app/business/models/vehicle.models\";\nimport { RateService } from \"src/app/business/services/rate.service\";\nimport { VehicleService } from \"src/app/business/services/vehicle.service\";\nimport { InvoicesStateService } from \"src/app/business/state/invoice-state.service\";\nimport { NotificationService } from \"src/app/shared/notifications/notification.service\";\nimport { regexs } from \"../../core/config/constants\";\n\nexport interface AddVehicleDialogData {\n  action: \"new\" | \"edit\";\n  onBackToInvoice: (...args: any) => any;\n}\n\n@Component({\n  selector: \"app-add-vehicle-dialog\",\n  templateUrl: \"./add-vehicle-dialog.component.html\",\n  styleUrls: [\"./add-vehicle-dialog.component.scss\"],\n})\nexport class AddVehicleDialogComponent implements OnInit, OnDestroy {\n  subscriptions: Subscription[] = [];\n  vehicleForm: FormGroup;\n  years: number[] = [];\n  makes: string[] = [];\n  models: string[] = [];\n  rate: Rate;\n  vehicleSearched: VinData;\n  selectedInvoice: Partial<Invoice>;\n\n  constructor(\n    public dialogRef: MatDialogRef<AddVehicleDialogComponent>,\n    @Inject(MAT_DIALOG_DATA) public data: AddVehicleDialogData,\n    private fb: FormBuilder,\n    private vehicleService: VehicleService,\n    private invoicesState: InvoicesStateService,\n    private notificationService: NotificationService,\n    private rateService: RateService\n  ) {\n    this.buildForm();\n    const sub = this.invoicesState.selectedInvoice$.subscribe((data) => {\n      this.selectedInvoice = data;\n\n      const sub = this.rateService.rates.subscribe((rates) => {\n        const currentShipFromCity = (this.selectedInvoice?.ship_from || this.selectedInvoice?.quick_ship_from)?.city;\n        const currentShipToCity = (this.selectedInvoice?.ship_to || this.selectedInvoice?.quick_ship_to)?.city;\n\n        this.rate = rates.find((rt) => {\n          return (\n            `${rt.origination_city.name}_${rt.origination_city.state_code}_${rt.destination_city.name}_${rt.destination_city.state_code}` ===\n            `${currentShipFromCity?.name}_${currentShipFromCity?.state_code}_${currentShipToCity?.name}_${currentShipToCity?.state_code}`\n          );\n        });\n        if (this.rate?.amount) {\n          this.vehicleForm.controls.amount.setValue(this.rate.amount);\n        }\n      });\n\n      this.subscriptions.push(sub);\n\n      if (!this.rateService.rates.value?.length) {\n        this.rateService.fetchRates();\n      }\n    });\n    this.subscriptions.push(sub);\n  }\n\n  ngOnInit() {\n    this.years = this.vehicleService.years\n  }\n\n  onSelectYear(event: any) {\n    //TODO: get makes by year\n    this.makes = this.vehicleService.makes;\n  }\n\n  async onSelectMake(event: any) {\n    this.models = await this.vehicleService.getModelsByMake(event.target.value);\n    this.vehicleForm.controls.model.setValue(\"\")\n  }\n\n  buildForm() {\n    this.vehicleForm = this.fb.group({\n      vin: [\"\", [Validators.required, Validators.pattern(regexs.vin)]],\n      year: [\"\", [Validators.required]],\n      make: [\"\", [Validators.required]],\n      model: [\"\", [Validators.required]],\n      amount: [\"\", [Validators.required]],\n      weight: [\"\", []],\n      comments: [\"\", []],\n    });\n  }\n\n  onSearchVin(e: any) {\n    const vin = e.target.value;\n\n    if (this.vehicleForm.controls.vin.valid) {\n      this.vehicleService\n        .searchVin(vin.toUpperCase())\n        .then((data) => {\n          this.vehicleSearched = data;\n          this.makes.push(data.make);\n          this.models.push(data.model);\n          this.vehicleForm.controls.year.setValue(data.year);\n          this.vehicleForm.controls.make.setValue(data.make);\n          this.vehicleForm.controls.model.setValue(data.model);\n          this.vehicleForm.controls.weight.setValue(data.weight);\n        })\n        .catch((err) => {\n          this.vehicleSearched = null;\n          this.vehicleForm.controls.vin.setErrors({ faliedSearch: true });\n          this.vehicleForm.controls.vin.markAsTouched();\n        });\n    }\n  }\n\n  onSubmit() {\n    const vinControl = this.vehicleForm.controls.vin;\n    vinControl.setValue(vinControl.value?.toUpperCase());\n\n    if (this.vehicleForm.invalid) {\n      return Object.values(this.vehicleForm.controls).forEach((control) => {\n        if (control instanceof FormGroup) {\n          Object.values(control.controls).forEach((control) => control.markAsTouched());\n        } else {\n          control.markAsTouched();\n        }\n      });\n    } else {\n      try {\n        if (this.data.action === \"edit\") {\n          this.invoicesState.addSelectedInvoiceVehicle(this.vehicleForm.value);\n        } else {\n          this.invoicesState.addNewInvoiceVehicle(this.vehicleForm.value);\n        }\n      } catch (error) {\n        return this.notificationService.error(error.message);\n      }\n      this.data.onBackToInvoice();\n    }\n  }\n\n  ngOnDestroy() {\n    this.subscriptions.forEach((sub) => sub.unsubscribe());\n  }\n}\n","<h3>Bill to</h3>\n\n<div class=\"input-group pt-3\">\n  <div class=\"input-group-prepend\">\n    <span class=\"input-group-text\">\n      <i class=\"fas fa-search\"></i>\n    </span>\n  </div>\n  <input type=\"text\" class=\"form-control\" placeholder=\"Search customer...\" (input)=\"searchCustomers($event)\" />\n  <div class=\"w-100 text-secondary text-sm\">Min 3 characters</div>\n</div>\n\n<div class=\"w-100 my-3 table-wrapper table-responsive custom-scroll\">\n  <table class=\"table table-sm table-bordered\">\n    <thead>\n      <tr>\n        <th scope=\"col\">Customer list</th>\n      </tr>\n    </thead>\n    <tbody>\n      <div class=\"w-100 text-center\" *ngIf=\"!foundCustomers?.length\">\n        <p class=\"border py-2\">No customers found</p>\n      </div>\n      <tr *ngFor=\"let customer of foundCustomers\" (click)=\"onSelect(customer)\">\n        <td>{{ customer.name }}</td>\n      </tr>\n    </tbody>\n  </table>\n</div>\n\n<div class=\"w-100 my-3 table-wrapper table-responsive custom-scroll\">\n  <table class=\"table table-sm table-bordered\">\n    <thead>\n      <tr>\n        <th scope=\"col\">Most recent</th>\n      </tr>\n    </thead>\n    <tbody>\n      <!-- <div class=\"w-100 text-center\">\n        <p class=\"border py-2\">No customers found</p>\n      </div> -->\n      <div class=\"w-100 text-center\" *ngIf=\"!mostRecentsCustomers?.length\">\n        <p class=\"border py-2\">No customers found</p>\n      </div>\n      <tr *ngFor=\"let customer of mostRecentsCustomers\" (click)=\"onSelect(customer)\">\n        <td>{{ customer.name }}</td>\n      </tr>\n    </tbody>\n  </table>\n</div>\n\n<div class=\"w-100 mt-3\">\n  <button class=\"w-100 btn btn-outline-primary\" (click)=\"backToInvoice()\">Back to invoice</button>\n</div>\n","import { Component, Inject, OnDestroy, OnInit } from \"@angular/core\";\nimport { MatDialogRef, MAT_DIALOG_DATA } from \"@angular/material/dialog\";\nimport { CustomerService } from \"src/app/business/services/customer.service\";\nimport { Customer } from \"src/app/business/models/customer.models\";\nimport { InvoicesStateService } from \"src/app/business/state/invoice-state.service\";\nimport { Subscription } from \"rxjs\";\n\nexport interface BillToDialogData {\n  action: \"new\" | \"edit\";\n  onBackToInvoice: (...args: any) => any;\n}\n\n@Component({\n  selector: \"app-bill-to-dialog\",\n  templateUrl: \"./bill-to-dialog.component.html\",\n  styleUrls: [\"./bill-to-dialog.component.scss\"],\n})\nexport class BillToDialogComponent implements OnInit, OnDestroy {\n  subscriptions: Subscription[] = [];\n  foundCustomers: Customer[] = [];\n  mostRecentsCustomers: Customer[] = [];\n\n  constructor(\n    public dialogRef: MatDialogRef<BillToDialogComponent>,\n    @Inject(MAT_DIALOG_DATA) public data: BillToDialogData,\n    public customerService: CustomerService,\n    private invoicesState: InvoicesStateService\n  ) {}\n\n  backToInvoice() {\n    this.data.onBackToInvoice();\n  }\n\n  ngOnInit() {\n    const sub = this.invoicesState.mostRecentsCustomers$.subscribe((data) => {\n      this.mostRecentsCustomers = data;\n    });\n    this.subscriptions.push(sub);\n  }\n\n  async searchCustomers(e: any) {\n    const query = e.target.value;\n    this.foundCustomers = await this.customerService.searchCustomers(query);\n  }\n\n  onSelect(customer: Customer) {\n    if (this.data.action === \"edit\") {\n      this.invoicesState.setSelectedInvoice({ bill_to: customer });\n    } else {\n      this.invoicesState.setNewInvoice({ bill_to: customer });\n    }\n    this.data.onBackToInvoice();\n  }\n\n  ngOnDestroy() {\n    this.subscriptions.forEach((sub) => sub.unsubscribe());\n  }\n}\n","<h3>{{ !viewMode ? 'Edit vehicle' : 'Vehicle' }}</h3>\n\n<form class=\"form-group\" [formGroup]=\"vehicleForm\" (ngSubmit)=\"onSubmit()\">\n    <div class=\"w-100 input-group pt-2 mb-3\">\n        <div class=\"input-group-prepend\">\n            <span class=\"input-group-text\">\n                <i class=\"fas fa-search\"></i>\n            </span>\n        </div>\n        <input\n            (input)=\"onSearchVin($event)\"\n            type=\"text\"\n            class=\"form-control\"\n            placeholder=\"Search VIN...\"\n            formControlName=\"vin\"\n            [class.is-invalid]=\"vehicleForm.controls.vin.touched && vehicleForm.controls.vin.invalid\"\n            [class.is-valid]=\"!!this.vehicleSearched\"\n        />\n        <div class=\"form-text invalid-feedback\" *ngIf=\"true\">\n            {{ vehicleForm.controls.vin.errors?.faliedSearch ? 'VIN not found' : 'Invalid VIN' }}\n        </div>\n    </div>\n\n    <div class=\"w-100 mb-3\">\n        <label for=\"year\" class=\"text-dark text-base\">Year</label>\n        <div class=\"custom-select-wrapper\">\n            <select\n                class=\"custom-select form-control\"\n                formControlName=\"year\"\n                [class.is-invalid]=\"vehicleForm.controls.year.touched && vehicleForm.controls.year.invalid\"\n                (change)=\"onSelectYear($event)\"\n            >\n                <option disabled value=\"\">Select year...</option>\n                <option *ngFor=\"let year of years\" [value]=\"year\">{{ year }}</option>\n            </select>\n            <mat-icon class=\"half-arrow-icon\" svgIcon=\"half-arrow-down\"></mat-icon>\n        </div>\n    </div>\n\n    <div class=\"w-100 mb-3\">\n        <label for=\"make\" class=\"text-dark text-base\">Make</label>\n        <div class=\"custom-select-wrapper\">\n            <select\n                class=\"custom-select form-control\"\n                formControlName=\"make\"\n                [class.is-invalid]=\"vehicleForm.controls.make.touched && vehicleForm.controls.make.invalid\"\n                (change)=\"onSelectMake($event)\"\n            >\n                <option disabled value=\"\">Select make...</option>\n                <option *ngFor=\"let make of makes\" [value]=\"make\">{{ make }}</option>\n            </select>\n            <mat-icon class=\"half-arrow-icon\" svgIcon=\"half-arrow-down\"></mat-icon>\n        </div>\n    </div>\n\n    <div class=\"w-100 mb-3\">\n        <label for=\"model\" class=\"text-dark text-base\">Model</label>\n        <div class=\"custom-select-wrapper\">\n            <select\n                class=\"custom-select form-control\"\n                formControlName=\"model\"\n                [class.is-invalid]=\"vehicleForm.controls.model.touched && vehicleForm.controls.model.invalid\"\n            >\n                <option disabled value=\"\">Select model...</option>\n                <option *ngFor=\"let model of models\" [value]=\"model\">{{ model }}</option>\n            </select>\n            <mat-icon class=\"half-arrow-icon\" svgIcon=\"half-arrow-down\"></mat-icon>\n        </div>\n    </div>\n\n    <div class=\"w-100 mb-3\">\n        <label for=\"amount\" class=\"text-dark text-base\">Amount</label>\n        <div class=\"input-group\">\n            <div class=\"input-group-prepend\">\n                <span class=\"input-group-text\"> $ </span>\n            </div>\n            <input\n                type=\"number\"\n                class=\"form-control\"\n                placeholder=\"Amount...\"\n                formControlName=\"amount\"\n                [class.is-invalid]=\"vehicleForm.controls.amount.touched && vehicleForm.controls.amount.invalid\"\n            />\n        </div>\n    </div>\n\n    <div class=\"w-100 mb-3\">\n        <label for=\"weight\" class=\"text-dark text-base\">Weight</label>\n        <div class=\"input-group\">\n            <div class=\"input-group-prepend\">\n                <span class=\"input-group-text\"> Kg </span>\n            </div>\n            <input\n                type=\"number\"\n                class=\"form-control\"\n                placeholder=\"Weight...\"\n                formControlName=\"weight\"\n                [class.is-invalid]=\"vehicleForm.controls.weight.touched && vehicleForm.controls.weight.invalid\"\n            />\n        </div>\n    </div>\n\n    <div class=\"w-100\">\n        <label for=\"comments\" class=\"text-dark text-base\">Comments</label>\n        <textarea\n            class=\"form-control\"\n            id=\"textarea\"\n            maxlength=\"256\"\n            rows=\"3\"\n            formControlName=\"comments\"\n            [class.is-invalid]=\"vehicleForm.controls.comments.touched && vehicleForm.controls.comments.invalid\"\n        ></textarea>\n    </div>\n\n    <div *ngIf=\"!viewMode\" class=\"d-flex w-100 px-4 pt-3 justify-content-between mt-3\">\n        <div class=\"col-5\">\n            <button class=\"btn w-100 btn-outline-secondary\" type=\"button\" (click)=\"data.onBackToInvoice()\">\n                Cancel\n            </button>\n        </div>\n        <div class=\"col-5\">\n            <button class=\"btn w-100 btn-success\" type=\"submit\">Save</button>\n        </div>\n    </div>\n\n    <div *ngIf=\"viewMode\" class=\"d-flex w-100 px-4 pt-3 justify-content-center mt-3\">\n        <div class=\"col-5\">\n            <button class=\"btn w-100 btn-outline-secondary\" type=\"button\" (click)=\"data.onBackToInvoice()\">Back</button>\n        </div>\n    </div>\n</form>\n","import { Component, Inject, OnDestroy, OnInit } from \"@angular/core\";\nimport { FormBuilder, FormGroup, Validators } from \"@angular/forms\";\nimport { MatDialogRef, MAT_DIALOG_DATA } from \"@angular/material/dialog\";\nimport { Subscription } from \"rxjs\";\nimport { Rate } from \"src/app/business/models/rate.models\";\nimport { Vehicle, VinData } from \"src/app/business/models/vehicle.models\";\nimport { VehicleService } from \"src/app/business/services/vehicle.service\";\nimport { InvoicesStateService } from \"src/app/business/state/invoice-state.service\";\nimport { regexs } from \"src/app/core/config/constants\";\nimport { NotificationService } from \"src/app/shared/notifications/notification.service\";\n\nexport interface EditVehicleDialogData {\n  action: \"new\" | \"edit\";\n  onBackToInvoice: (...args: any) => any;\n  vehicle: Vehicle;\n  viewMode: boolean;\n}\n\n@Component({\n  selector: \"app-edit-vehicle-dialog\",\n  templateUrl: \"./edit-vehicle-dialog.component.html\",\n  styleUrls: [\"./edit-vehicle-dialog.component.scss\"],\n})\nexport class EditVehicleDialogComponent implements OnInit, OnDestroy {\n  subscriptions: Subscription[] = [];\n  vehicleForm: FormGroup;\n  years: number[] = [];\n  makes: string[] = [];\n  models: string[] = [];\n  rate: Rate;\n  vehicleSearched: VinData;\n  viewMode: boolean;\n\n  constructor(\n    public dialogRef: MatDialogRef<EditVehicleDialogComponent>,\n    @Inject(MAT_DIALOG_DATA) public data: EditVehicleDialogData,\n    private fb: FormBuilder,\n    private vehicleService: VehicleService,\n    private invoicesState: InvoicesStateService,\n    private notificationService: NotificationService\n  ) {\n    this.viewMode = this.data.viewMode;\n    this.buildForm();\n    const sub = this.invoicesState.currentRate$.subscribe((rate) => {\n      this.rate = rate;\n      if (rate?.amount) {\n        this.vehicleForm.controls.amount.setValue(rate.amount);\n      }\n    });\n    this.subscriptions.push(sub);\n  }\n\n  ngOnInit() {\n    this.years = this.vehicleService.years;\n    this.makes = this.vehicleService.makes;\n    this.makes.push(this.data.vehicle.make);\n    this.models.push(this.data.vehicle.model);\n    this.getModels(this.data.vehicle.make);\n    //TODO: get models by make ande year\n  }\n\n  onSelectYear(event: any) {\n    //TODO: get makes by year\n    //this.makes = this.vehicleService.makes;\n  }\n\n  onSelectMake(event: any) {\n    this.getModels(event.target.value);\n    this.vehicleForm.controls.model.setValue(\"\");\n  }\n\n  async getModels(make: string) {\n    this.models = await this.vehicleService.getModelsByMake(make);\n  }\n\n  buildForm() {\n    this.vehicleForm = this.fb.group({\n      vin: [{ value: this.data.vehicle.vin, disabled: this.viewMode }, [Validators.required, Validators.pattern(regexs.vin)]],\n      year: [{ value: this.data.vehicle.year, disabled: this.viewMode }, [Validators.required]],\n      make: [{ value: this.data.vehicle.make, disabled: this.viewMode }, [Validators.required]],\n      model: [{ value: this.data.vehicle.model, disabled: this.viewMode }, [Validators.required]],\n      amount: [{ value: this.data.vehicle.amount, disabled: this.viewMode }, [Validators.required]],\n      weight: [{ value: this.data.vehicle.weight, disabled: this.viewMode }, []],\n      comments: [{ value: this.data.vehicle.comments, disabled: this.viewMode }, []],\n    });\n  }\n\n  async onSearchVin(e: any) {\n    const vin = e.target.value;\n\n    if (this.vehicleForm.controls.vin.valid) {\n      this.vehicleService\n        .searchVin(vin.toUpperCase())\n        .then((data) => {\n          this.vehicleSearched = data;\n          this.makes.push(data.make);\n          this.models.push(data.model);\n          this.vehicleForm.controls.year.setValue(data.year);\n          this.vehicleForm.controls.make.setValue(data.make);\n          this.vehicleForm.controls.model.setValue(data.model);\n          this.vehicleForm.controls.weight.setValue(data.weight);\n        })\n        .catch((err) => {\n          this.vehicleSearched = null;\n          this.vehicleForm.controls.vin.setErrors({ faliedSearch: true });\n          this.vehicleForm.controls.vin.markAsTouched();\n        });\n    }\n  }\n\n  onSubmit() {\n    const vinControl = this.vehicleForm.controls.vin;\n    vinControl.setValue(vinControl.value?.toUpperCase());\n\n    if (this.vehicleForm.invalid) {\n      return Object.values(this.vehicleForm.controls).forEach((control) => {\n        if (control instanceof FormGroup) {\n          Object.values(control.controls).forEach((control) => control.markAsTouched());\n        } else {\n          control.markAsTouched();\n        }\n      });\n    } else {\n      try {\n        if (this.data.action === \"edit\") {\n          this.invoicesState.editSelectedInvoiceVehicle(this.vehicleForm.value, this.data.vehicle?._id);\n        } else {\n          this.invoicesState.editNewInvoiceVehicle(this.vehicleForm.value, this.data.vehicle?._id);\n        }\n      } catch (error) {\n        return this.notificationService.error(error.message);\n      }\n      this.data.onBackToInvoice();\n    }\n  }\n\n  ngOnDestroy() {\n    this.subscriptions.forEach((sub) => sub.unsubscribe());\n  }\n}\n","<div class=\"dialog-content custom-scroll\">\n  <div *ngIf=\"isLoading\" class=\"dialog-loader\">\n    <mat-spinner [diameter]=\"50\"></mat-spinner>\n  </div>\n  <h3>New Invoice</h3>\n\n  <form class=\"form-group w-100 mt-3 new-invoice-form mb-2\">\n    <div class=\"col-12 d-flex justify-content-between mb-3 text-xl\">\n      <span> Invoice #: ----</span>\n      <span>Date: ----</span>\n    </div>\n\n    <div class=\"col-12 mb-3\">\n      <label for=\"driver\" class=\"text-dark text-base\">Driver</label>\n      <div class=\"custom-select-wrapper\">\n        <select class=\"custom-select form-control\" (change)=\"onSelectDriver($event)\">\n          <option *ngIf=\"!invoice?.driver\" selected disabled value=\"\">Select driver...</option>\n          <option *ngFor=\"let driver of drivers\" [value]=\"driver.id\" [selected]=\"driver.id === invoice?.driver\">\n            <span>{{ driver.first_name | titlecase }} {{ driver.last_name | titlecase }}</span> - {{ driver.email }}\n          </option>\n        </select>\n        <mat-icon class=\"half-arrow-icon\" svgIcon=\"half-arrow-down\"></mat-icon>\n      </div>\n    </div>\n\n    <div class=\"col-12 mb-3\">\n      <label for=\"status\" class=\"text-dark text-base\">Status</label>\n      <div class=\"custom-select-wrapper\">\n        <select class=\"custom-select form-control\" (change)=\"onSelectStatus($event)\">\n          <option *ngFor=\"let status of statuses\" [value]=\"status.value\" [selected]=\"invoice?.status && status.value === invoice?.status\">\n            {{ status.label }}\n          </option>\n        </select>\n        <mat-icon class=\"half-arrow-icon\" svgIcon=\"half-arrow-down\"></mat-icon>\n      </div>\n    </div>\n\n    <div class=\"mt-2 w-100\">\n      <div class=\"col-12 d-flex flex-column align-items-start flex-md-row align-items-md-center mb-3\">\n        <button type=\"button\" class=\"flex-shrink-0 btn btn-primary mr-3 cust-btn\" (click)=\"data.onBillTo()\">Bill To</button>\n        <span class=\"bg-grey-light flex-grow-1 h-100 p-2 rounded-lg w-100\">\n          {{ invoice?.bill_to ? invoice?.bill_to.name : \"----\" }}\n          {{ invoice?.bill_to && \" - \" + (invoice?.bill_to.city | location) }}\n        </span>\n      </div>\n\n      <div class=\"col-12 d-flex flex-column align-items-start flex-md-row align-items-md-center mb-3\">\n        <button type=\"button\" class=\"flex-shrink-0 btn btn-primary mr-3 cust-btn\" (click)=\"data.onShipFrom()\">Ship From</button>\n        <span class=\"bg-grey-light flex-grow-1 h-100 p-2 rounded-lg w-100\">\n          {{ (invoice?.ship_from || invoice?.quick_ship_from)?.name || \"----\" }}\n          {{\n            (invoice?.ship_from || invoice?.quick_ship_from) && \" - \" + ((invoice?.ship_from || invoice?.quick_ship_from)?.city | location)\n          }}\n        </span>\n      </div>\n\n      <div class=\"col-12 d-flex flex-column align-items-start flex-md-row align-items-md-center mb-3\">\n        <button type=\"button\" class=\"flex-shrink-0 btn btn-primary mr-3 cust-btn\" (click)=\"data.onShipTo()\">Ship To</button>\n        <span class=\"bg-grey-light flex-grow-1 h-100 p-2 rounded-lg w-100\">\n          {{ (invoice?.ship_to || invoice?.quick_ship_to)?.name || \"----\" }}\n          {{ (invoice?.ship_to || invoice?.quick_ship_to) && \" - \" + ((invoice?.ship_to || invoice?.quick_ship_to)?.city | location) }}\n        </span>\n      </div>\n    </div>\n  </form>\n\n  <div class=\"w-100 mb-3 table-wrapper table-responsive custom-scroll\">\n    <table class=\"table table-sm mb-0 pb-5\">\n      <thead>\n        <tr>\n          <th scope=\"col\">Vehicle</th>\n          <th scope=\"col\">Vin</th>\n          <th scope=\"col\">Amount</th>\n          <th scope=\"col\"></th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr *ngFor=\"let vehicle of invoice?.vehicles\">\n          <td>{{ vehicle.year }} {{ vehicle.make }} {{ vehicle.model }}</td>\n          <td>{{ vehicle.vin }}</td>\n          <td>{{ vehicle.amount | currency }}</td>\n          <td class=\"action-buttons\">\n            <button (click)=\"data.onEditVehicle(vehicle)\"><i class=\"fas fa-edit text-xl mr-3\"></i></button>\n            <button (click)=\"data.onDeleteVehicle(vehicle)\"><i class=\"fas fa-trash-alt text-xl\"></i></button>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n    <div class=\"w-100 text-center\" *ngIf=\"!invoice?.vehicles?.length\">\n      <p class=\"border py-2\">No vehicles added</p>\n    </div>\n    <div class=\"flex-grow-1 bg-light add-vehicle-btn py-1\">\n      <button class=\"w-100 btn btn-outline-primary\" (click)=\"data.onAddVehicle()\">+ Add vehicle</button>\n    </div>\n  </div>\n\n  <div class=\"w-100 bg-grey-light p-4 rounded-lg\">\n    <div class=\"row\">\n      <span class=\"col-8 text-right\">Sub total:</span>\n      <span class=\"col-4 text-right\">${{ getSubTotal()?.toFixed(2) }}</span>\n    </div>\n    <div class=\"row\">\n      <span class=\"col-8 text-right\">Driver commission:</span>\n      <span class=\"col-4 text-right\">%{{ invoice?.driver?.commission || 0 }}</span>\n    </div>\n    <div class=\"row\">\n      <span class=\"col-8 text-right\">Driver commission amount:</span>\n      <span class=\"col-4 text-right\">${{ getDriverCommissionAmount()?.toFixed(2) }}</span>\n    </div>\n    <div class=\"row\">\n      <span class=\"col-8 text-right\">Total units:</span>\n      <span class=\"col-4 text-right\">{{ invoice?.vehicles?.length || 0 }}</span>\n    </div>\n    <div class=\"row\">\n      <span class=\"col-8 text-right\">Weight(kg):</span>\n      <span class=\"col-4 text-right\">{{ getWeight()?.toFixed(2) }}</span>\n    </div>\n    <div class=\"col-12 border border-secondary my-2\" style=\"opacity: 0.25\"></div>\n    <div class=\"row font-bold\">\n      <span class=\"col-8 text-right\">Total:</span>\n      <span class=\"col-4 text-right\">${{ getTotal()?.toFixed(2) }}</span>\n    </div>\n  </div>\n\n  <div class=\"d-flex w-100 px-0 px-md-4 pt-4 justify-content-between mt-2\">\n    <div class=\"col-5\">\n      <button class=\"btn w-100 btn-secondary\" (click)=\"onCancel()\">Cancel</button>\n    </div>\n    <div class=\"col-5\">\n      <button class=\"btn w-100 btn-success\" (click)=\"onSubmit()\">Save</button>\n    </div>\n  </div>\n</div>\n","import { StepperSelectionEvent } from \"@angular/cdk/stepper\";\nimport { Component, Inject, OnDestroy, OnInit } from \"@angular/core\";\nimport { MatDialogRef, MAT_DIALOG_DATA } from \"@angular/material/dialog\";\nimport { Subscription } from \"rxjs\";\nimport { Invoice, InvoiceBody, InvoiceStatus } from \"src/app/business/models/invoice.models\";\nimport { User } from \"src/app/business/models/user.models\";\nimport { Vehicle } from \"src/app/business/models/vehicle.models\";\nimport { CustomerService } from \"src/app/business/services/customer.service\";\nimport { InvoiceService } from \"src/app/business/services/invoice.service\";\nimport { RateService } from \"src/app/business/services/rate.service\";\nimport { UserService } from \"src/app/business/services/user.service\";\nimport { InvoicesStateService } from \"src/app/business/state/invoice-state.service\";\nimport { NotificationService } from \"src/app/shared/notifications/notification.service\";\n\nexport interface NewInvoiceDialogData {\n  onBillTo: (...args: any) => any;\n  onShipFrom: (...args: any) => any;\n  onShipTo: (...args: any) => any;\n  onAddVehicle: (...args: any) => any;\n  onEditVehicle: (vehicle: Vehicle) => any;\n  onDeleteVehicle: (vehicle: Vehicle) => any;\n  currentStep: 0 | 1;\n  setCurrentStep: (idx: 0 | 1) => any;\n}\n\ninterface Statuses {\n  value: InvoiceStatus;\n  label: string;\n}\n\nconst statuses: Statuses[] = [\n  { value: \"DRAFT\", label: \"Draft\" },\n  { value: \"SUBMITTED_FOR_REVIEW\", label: \"Submitted for review\" },\n  // { value: \"SUBMITTED_TO_CUSTOMER\", label: \"Submitted to customers\" },\n  // { value: \"PAID\", label: \"Paid\" },\n];\n\n@Component({\n  selector: \"app-new-invoice-dialog\",\n  templateUrl: \"./new-invoice-dialog.component.html\",\n  styleUrls: [\"./new-invoice-dialog.component.scss\"],\n})\nexport class NewInvoiceDialogComponent implements OnInit, OnDestroy {\n  subscriptions: Subscription[] = [];\n  drivers: User[];\n  statuses: Statuses[] = statuses;\n  invoice: Partial<Invoice>;\n  isLoading = false;\n\n  constructor(\n    public dialogRef: MatDialogRef<NewInvoiceDialogComponent>,\n    @Inject(MAT_DIALOG_DATA) public data: NewInvoiceDialogData,\n    private userService: UserService,\n    public invoicesState: InvoicesStateService,\n    private rateService: RateService,\n    private notificationService: NotificationService,\n    private invoiceService: InvoiceService,\n    private customerService: CustomerService\n  ) {\n    const sub1 = this.userService.users.subscribe((data) => {\n      this.drivers = data;\n    });\n    const sub2 = this.invoicesState.newInvoice$.subscribe((invoice) => {\n      this.invoice = invoice;\n    });\n    this.subscriptions.push(sub1, sub2);\n  }\n\n  ngOnInit() {\n    this.userService.fetchUsers();\n\n    const sub = this.customerService.getMostRecents().subscribe((data) => {\n      this.invoicesState.setMostRecentsCustomers(data);\n    });\n    this.subscriptions.push(sub);\n  }\n\n  onSelectDriver(event: any) {\n    this.invoicesState.setNewInvoice({ driver: this.drivers.find((d) => d.id === event.target.value) });\n  }\n\n  onSelectStatus(event: any) {\n    this.invoicesState.setNewInvoice({ status: event.target.value });\n  }\n\n  onStepChange(event: StepperSelectionEvent) {\n    this.data.setCurrentStep(event.selectedIndex as 0 | 1);\n    if (event.selectedIndex === 1) {\n      //get current rate\n      const from: any = this.invoice?.ship_from ?? {};\n      const to: any = this.invoice?.ship_to ?? {};\n      const code = `${from.city?.name}_${from.city?.state_code}_${to.city?.name}_${to.city?.state_code}`;\n      this.rateService.getRateByCode(code).subscribe((rate) => {\n        this.invoicesState.setCurretRate(rate);\n      });\n    }\n  }\n\n  getSubTotal() {\n    let subtotal = 0;\n    this.invoice?.vehicles?.forEach((v) => {\n      subtotal += v.amount;\n    });\n    return subtotal;\n  }\n\n  getTotal() {\n    let total = 0;\n    this.invoice?.vehicles?.forEach((v) => {\n      total += v.amount;\n    });\n    return total;\n  }\n\n  getWeight() {\n    let weight = 0;\n    this.invoice?.vehicles?.forEach((v) => {\n      weight += Number(v.weight);\n    });\n    return weight;\n  }\n\n  getDriverCommissionAmount() {\n    const total = this.getSubTotal();\n    const driverCommission = this.invoice?.driver?.commission ?? 0;\n    const amount = total * (driverCommission / 100);\n    return amount;\n  }\n\n  onSubmit() {\n    if (\n      !this.invoice?.driver ||\n      !this.invoice?.status ||\n      !this.invoice?.bill_to ||\n      !(this.invoice?.ship_from ?? this.invoice?.quick_ship_from) ||\n      !(this.invoice?.ship_to ?? this.invoice?.quick_ship_to)\n    ) {\n      this.notificationService.error(\"Missed fields required\");\n      return;\n    }\n\n    if (!this.invoice?.vehicles?.length) {\n      this.notificationService.error(\"Missed vehicles required\");\n      return;\n    }\n\n    const body: InvoiceBody = {\n      bill_to: this.invoice.bill_to.id,\n      ship_from: this.invoice.ship_from?.id,\n      ship_to: this.invoice.ship_to?.id,\n      quick_ship_from: this.invoice.quick_ship_from,\n      quick_ship_to: this.invoice.quick_ship_to,\n      driver_id: this.invoice.driver.id,\n      status: this.invoice.status,\n      vehicles: this.invoice.vehicles?.map(({ _id, ...rest }) => rest),\n    };\n\n    this.isLoading = true;\n    this.invoiceService.saveInvoice(body).subscribe(\n      (res) => {\n        this.isLoading = false;\n        this.notificationService.success(\"Invoice saved\");\n        this.dialogRef.close();\n        this.invoicesState.resetNewInvoice();\n      },\n      (err) => {\n        this.notificationService.error();\n        this.isLoading = false;\n      }\n    );\n  }\n\n  onCancel() {\n    this.invoicesState.resetNewInvoice();\n    this.data.setCurrentStep(0);\n    this.dialogRef.close();\n  }\n\n  ngOnDestroy() {\n    this.subscriptions.forEach((sub) => sub.unsubscribe());\n  }\n}\n","<div class=\"dialog-content custom-scroll\">\n  <div *ngIf=\"isLoading\" class=\"dialog-loader\">\n    <mat-spinner [diameter]=\"50\"></mat-spinner>\n  </div>\n  <h3>{{ viewMode ? 'Invoice' : 'Edit Invoice' }}</h3>\n\n  <form class=\"form-group w-100 mt-3 new-invoice-form mb-2\">\n    <div class=\"col-12 d-flex justify-content-between mb-3 text-xl\">\n      <span> Invoice #: {{ invoice?.number }}</span>\n      <span>Date: {{ invoice?.date | date: \"MM/dd/yyyy\" }}</span>\n    </div>\n\n    <div class=\"col-12 mb-3\">\n      <label for=\"driver\" class=\"text-dark text-base\">Driver</label>\n      <div class=\"custom-select-wrapper\">\n        <select [disabled]=\"viewMode\" class=\"custom-select form-control\" (change)=\"onSelectDriver($event)\">\n          <option *ngIf=\"!invoice?.driver\" selected disabled value=\"\">Select driver...</option>\n          <option *ngFor=\"let driver of drivers\" [value]=\"driver.id\" [selected]=\"driver.id === invoice?.driver?.id\">\n            <span>{{ driver.first_name | titlecase }} {{ driver.last_name | titlecase }}</span> - {{ driver.email }}\n          </option>\n        </select>\n        <mat-icon class=\"half-arrow-icon\" svgIcon=\"half-arrow-down\"></mat-icon>\n      </div>\n    </div>\n\n    <div class=\"col-12 mb-3\">\n      <label for=\"status\" class=\"text-dark text-base\">Status</label>\n      <div class=\"custom-select-wrapper\">\n        <select [disabled]=\"viewMode\" class=\"custom-select form-control\" (change)=\"onSelectStatus($event)\">\n          <option *ngFor=\"let status of statuses\" [value]=\"status.value\" [selected]=\"invoice?.status && status.value === invoice?.status\">\n            {{ viewMode ? parseStatus(invoice.status) : status.label  }}\n          </option>\n        </select>\n        <mat-icon class=\"half-arrow-icon\" svgIcon=\"half-arrow-down\"></mat-icon>\n      </div>\n    </div>\n\n    <div class=\"mt-2 w-100\">\n      <div class=\"col-12 d-flex flex-column align-items-start flex-md-row align-items-md-center mb-3\">\n        <button [disabled]=\"viewMode\" type=\"button\" class=\"flex-shrink-0 btn btn-primary mr-3 cust-btn\" (click)=\"data.onBillTo()\">Bill To</button>\n        <span class=\"bg-grey-light flex-grow-1 h-100 p-2 rounded-lg w-100\">\n          {{ invoice?.bill_to ? invoice?.bill_to.name : \"----\" }}\n          {{ invoice?.bill_to && \" - \" + (invoice?.bill_to.city | location) }}\n        </span>\n      </div>\n\n      <div class=\"col-12 d-flex flex-column align-items-start flex-md-row align-items-md-center mb-3\">\n        <button [disabled]=\"viewMode\" type=\"button\" class=\"flex-shrink-0 btn btn-primary mr-3 cust-btn\" (click)=\"data.onShipFrom()\">Ship From</button>\n        <span class=\"bg-grey-light flex-grow-1 h-100 p-2 rounded-lg w-100\">\n          {{ (invoice?.ship_from || invoice?.quick_ship_from)?.name || \"----\" }}\n          {{\n            (invoice?.ship_from || invoice?.quick_ship_from) && \" - \" + ((invoice?.ship_from || invoice?.quick_ship_from)?.city | location)\n          }}\n        </span>\n      </div>\n\n      <div class=\"col-12 d-flex flex-column align-items-start flex-md-row align-items-md-center\">\n        <button [disabled]=\"viewMode\" type=\"button\" class=\"flex-shrink-0 btn btn-primary mr-3 cust-btn\" (click)=\"data.onShipTo()\">Ship To</button>\n        <span class=\"bg-grey-light flex-grow-1 h-100 p-2 rounded-lg w-100\">\n          {{ (invoice?.ship_to || invoice?.quick_ship_to)?.name || \"----\" }}\n          {{ (invoice?.ship_to || invoice?.quick_ship_to) && \" - \" + ((invoice?.ship_to || invoice?.quick_ship_to)?.city | location) }}\n        </span>\n      </div>\n    </div>\n  </form>\n\n  <div class=\"w-100 mb-3 table-wrapper table-responsive custom-scroll\">\n    <table class=\"table table-sm mb-0 pb-5\">\n      <thead>\n        <tr>\n          <th scope=\"col\">Vehicle</th>\n          <th scope=\"col\">Vin</th>\n          <th scope=\"col\">Amount</th>\n          <th scope=\"col\">Actions</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr *ngFor=\"let vehicle of invoice?.vehicles\">\n          <td>{{ vehicle.year }} {{ vehicle.make }} {{ vehicle.model }}</td>\n          <td>{{ vehicle.vin }}</td>\n          <td>{{ vehicle.amount | currency }}</td>\n          <td *ngIf=\"!viewMode\" class=\"action-buttons\">\n            <button (click)=\"data.onEditVehicle(vehicle)\"><i class=\"fas fa-edit text-xl mr-3\"></i></button>\n            <button (click)=\"data.onDeleteVehicle(vehicle)\"><i class=\"fas fa-trash-alt text-xl\"></i></button>\n          </td>\n          <td *ngIf=\"viewMode\" class=\"action-buttons justify-content-center\">\n            <button (click)=\"data.onEditVehicle(vehicle)\"><i class=\"fas fa-eye text-xl mr-3\"></i></button>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n    <div class=\"w-100 text-center\" *ngIf=\"!invoice?.vehicles?.length\">\n      <p class=\"border py-2\">No vehicles added</p>\n    </div>\n    <div *ngIf=\"!viewMode\" class=\"flex-grow-1 bg-light add-vehicle-btn py-1\">\n      <button class=\"w-100 btn btn-outline-primary\" (click)=\"data.onAddVehicle()\">+ Add vehicle</button>\n    </div>\n  </div>\n\n  <div class=\"w-100 bg-grey-light p-4 rounded-lg\">\n    <div class=\"row\">\n      <span class=\"col-8 text-right\">Sub total:</span>\n      <span class=\"col-4 text-right\">${{ getSubTotal()?.toFixed(2) }}</span>\n    </div>\n    <div class=\"row\">\n      <span class=\"col-8 text-right\">Driver commission:</span>\n      <span class=\"col-4 text-right\">%{{ invoice?.driver?.commission || 0 }}</span>\n    </div>\n    <div class=\"row\">\n      <span class=\"col-8 text-right\">Driver commission amount:</span>\n      <span class=\"col-4 text-right\">${{ getDriverCommissionAmount()?.toFixed(2) }}</span>\n    </div>\n    <div class=\"row\">\n      <span class=\"col-8 text-right\">Total units:</span>\n      <span class=\"col-4 text-right\">{{ invoice?.vehicles?.length || 0 }}</span>\n    </div>\n    <div class=\"row\">\n      <span class=\"col-8 text-right\">Weight(kg):</span>\n      <span class=\"col-4 text-right\">{{ getWeight()?.toFixed(2) }}</span>\n    </div>\n    <div class=\"col-12 border border-secondary my-2\" style=\"opacity: 0.25\"></div>\n    <div class=\"row font-bold\">\n      <span class=\"col-8 text-right\">Total:</span>\n      <span class=\"col-4 text-right\">${{ getTotal()?.toFixed(2) }}</span>\n    </div>\n  </div>\n\n  <div *ngIf=\"!viewMode\" class=\"d-flex w-100 px-0 px-md-4 pt-4 justify-content-between my-2\">\n    <div class=\"col-5\">\n      <button class=\"btn w-100 btn-secondary\" type=\"button\" (click)=\"onCancel()\">Cancel</button>\n    </div>\n    <div class=\"col-5\">\n      <button class=\"btn w-100 btn-success\" (click)=\"onSubmit()\">Save</button>\n    </div>\n  </div>\n\n  <div *ngIf=\"viewMode\" class=\"d-flex w-100 px-0 px-md-4 pt-4 justify-content-center my-2\">\n    <div class=\"col-5\">\n      <button class=\"btn w-100 btn-secondary\" type=\"button\" (click)=\"onCancel()\">Back</button>\n    </div>\n  </div>\n</div>\n","import { Component, Inject, OnDestroy, OnInit } from \"@angular/core\";\nimport { MatDialogRef, MAT_DIALOG_DATA } from \"@angular/material/dialog\";\nimport { Subscription } from \"rxjs\";\nimport { Invoice, InvoiceBody, InvoiceStatus } from \"src/app/business/models/invoice.models\";\nimport { User } from \"src/app/business/models/user.models\";\nimport { Vehicle } from \"src/app/business/models/vehicle.models\";\nimport { CustomerService } from \"src/app/business/services/customer.service\";\nimport { InvoiceService } from \"src/app/business/services/invoice.service\";\nimport { RateService } from \"src/app/business/services/rate.service\";\nimport { UserService } from \"src/app/business/services/user.service\";\nimport { InvoicesStateService } from \"src/app/business/state/invoice-state.service\";\nimport { NotificationService } from \"src/app/shared/notifications/notification.service\";\n\nexport interface EditInvoiceDialogData {\n  onBillTo: (...args: any) => any;\n  onShipFrom: (...args: any) => any;\n  onShipTo: (...args: any) => any;\n  onAddVehicle: (...args: any) => any;\n  onEditVehicle: (vehicle: Vehicle) => any;\n  onDeleteVehicle: (vehicle: Vehicle) => any;\n  currentStep: 0 | 1;\n  setCurrentStep: (idx: 0 | 1) => any;\n}\n\ninterface Statuses {\n  value: InvoiceStatus;\n  label: string;\n}\n\nconst statuses: Statuses[] = [\n  { value: \"DRAFT\", label: \"Draft\" },\n  { value: \"SUBMITTED_FOR_REVIEW\", label: \"Submitted for review\" },\n  // { value: \"SUBMITTED_TO_CUSTOMER\", label: \"Submitted to customers\" },\n  // { value: \"PAID\", label: \"Paid\" },\n];\n\n@Component({\n  selector: \"app-edit-invoice-dialog\",\n  templateUrl: \"./edit-invoice-dialog.component.html\",\n  styleUrls: [\"./edit-invoice-dialog.component.scss\"],\n})\nexport class EditInvoiceDialogComponent implements OnInit, OnDestroy {\n  subscriptions: Subscription[] = [];\n  drivers: User[];\n  statuses: Statuses[] = statuses;\n  invoice: Partial<Invoice>;\n  isLoading = false;\n  viewMode: boolean;\n\n  constructor(\n    public dialogRef: MatDialogRef<EditInvoiceDialogComponent>,\n    @Inject(MAT_DIALOG_DATA) public data: EditInvoiceDialogData,\n    private userService: UserService,\n    public invoicesState: InvoicesStateService,\n    private rateService: RateService,\n    private notificationService: NotificationService,\n    private invoiceService: InvoiceService,\n    private customerService: CustomerService\n  ) {\n    const sub1 = this.userService.users.subscribe((data) => {\n      this.drivers = data;\n    });\n    const sub2 = this.invoicesState.selectedInvoice$.subscribe((invoice) => {\n      this.invoice = invoice;\n      this.viewMode = invoice.status !== \"DRAFT\" && invoice.status !== \"SUBMITTED_FOR_REVIEW\"\n    });\n    this.subscriptions.push(sub1, sub2);\n  }\n\n  ngOnInit() {\n    this.userService.fetchUsers();\n\n    const sub = this.customerService.getMostRecents().subscribe((data) => {\n      this.invoicesState.setMostRecentsCustomers(data);\n    });\n    this.subscriptions.push(sub);\n  }\n\n  onSelectDriver(event: any) {\n    this.invoicesState.setSelectedInvoice({ driver: this.drivers.find((d) => d.id === event.target.value) });\n  }\n\n  onSelectStatus(event: any) {\n    this.invoicesState.setSelectedInvoice({ status: event.target.value });\n  }\n\n  getSubTotal() {\n    let subtotal = 0;\n    this.invoice?.vehicles?.forEach((v) => {\n      subtotal += v.amount;\n    });\n    return subtotal;\n  }\n\n  getTotal() {\n    let total = 0;\n    this.invoice?.vehicles?.forEach((v) => {\n      total += v.amount;\n    });\n    return total;\n  }\n\n  getWeight() {\n    let weight = 0;\n    this.invoice?.vehicles?.forEach((v) => {\n      weight += Number(v.weight);\n    });\n    return weight;\n  }\n\n  getDriverCommissionAmount() {\n    const total = this.getSubTotal();\n    const driverCommission = this.invoice?.driver?.commission ?? 0;\n    const amount = total * (driverCommission / 100);\n    return amount;\n  }\n\n  onSubmit() {\n    if (\n      !this.invoice?.driver ||\n      !this.invoice?.status ||\n      !this.invoice?.bill_to ||\n      !(this.invoice?.ship_from ?? this.invoice?.quick_ship_from) ||\n      !(this.invoice?.ship_to ?? this.invoice?.quick_ship_to)\n    ) {\n      this.notificationService.error(\"Missed fields required\");\n      return;\n    }\n\n    if (!this.invoice?.vehicles?.length) {\n      this.notificationService.error(\"Missed vehicles required\");\n      return;\n    }\n\n    const body: InvoiceBody = {\n      bill_to: this.invoice.bill_to.id,\n      ship_from: this.invoice.ship_from?.id,\n      ship_to: this.invoice.ship_to?.id,\n      quick_ship_from: this.invoice.quick_ship_from,\n      quick_ship_to: this.invoice.quick_ship_to,\n      driver_id: this.invoice.driver.id,\n      status: this.invoice.status,\n      vehicles: this.invoice.vehicles?.map(({ _id, ...rest }) => rest),\n    };\n\n    this.isLoading = true;\n    this.invoiceService.updateInvoice(body, this.invoice.id).subscribe(\n      (res) => {\n        this.isLoading = false;\n        this.data.setCurrentStep(0);\n        this.notificationService.success(\"Invoice updated\");\n        this.dialogRef.close();\n      },\n      (err) => {\n        this.notificationService.error();\n        this.isLoading = false;\n      }\n    );\n  }\n\n  onCancel() {\n    this.invoicesState.resetSelectedInvoice();\n    this.data.setCurrentStep(0);\n    this.dialogRef.close();\n  }\n\n  parseStatus(status: InvoiceStatus) {\n    switch (status) {\n      case \"DRAFT\":\n        return \"Draft\";\n      case \"SUBMITTED_FOR_REVIEW\":\n        return \"Submitted for review\";\n      case \"SUBMITTED_TO_CUSTOMER\":\n        return \"Submitted to customer\";\n      case \"PAID\":\n        return \"Paid\";\n      default:\n        return \"Unknown\";\n    }\n  }\n\n  ngOnDestroy() {\n    this.subscriptions.forEach((sub) => sub.unsubscribe());\n  }\n}\n","import { HttpClient } from '@angular/common/http'\nimport { Injectable } from '@angular/core'\nimport { map } from 'rxjs/operators'\nimport { environment } from 'src/environments/environment'\nimport { PaginatedResponse } from '../models/api.models'\nimport { Invoice, InvoiceBody, InvoicePaginatedResponse, InvoiceStatus } from '../models/invoice.models'\nimport { InvoicesStateService } from '../state/invoice-state.service'\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class InvoiceService {\n  private baseUrl = environment.apiUrl\n\n  constructor(private http: HttpClient, private invoicesState: InvoicesStateService) {}\n\n  fetchInvoices(status?: InvoiceStatus, limit: number = 0, page: number = 0): Promise<InvoicePaginatedResponse> {\n    return new Promise((resolve, reject) => {\n      let url = `${this.baseUrl}/invoices/admin?limit=${limit}&page=${page}`\n      if (status) {\n        url += `&status=${status}`\n      } else {\n        url += `&status=DRAFT&status=SUBMITTED_FOR_REVIEW&status=SUBMITTED_TO_CUSTOMER`\n      }\n      this.http.get<PaginatedResponse<Invoice>>(url).subscribe(\n        (data) => {\n          this.invoicesState.setInvoices(data.results)\n          resolve(data)\n        },\n        (err) => {\n          reject(err)\n        }\n      )\n    })\n  }\n\n  saveInvoice(body: InvoiceBody) {\n    return this.http.post<Invoice>(`${this.baseUrl}/invoices/admin`, body).pipe(\n      map((res) => {\n        this.fetchInvoices()\n        return res\n      })\n    )\n  }\n\n  updateInvoice(body: InvoiceBody, invoiceId: string) {\n    return this.http.put<Invoice>(`${this.baseUrl}/invoices/admin/${invoiceId}`, body).pipe(\n      map((res) => {\n        this.fetchInvoices()\n        return res\n      })\n    )\n  }\n\n  deleteInvoice(id: string) {\n    return this.http.delete<Invoice>(`${this.baseUrl}/invoices/admin/${id}`).pipe(\n      map((res) => {\n        this.fetchInvoices()\n        return res\n      })\n    )\n  }\n\n  submitDraftInvoices(invoiceIds: string[]) {\n    return this.http.post<Invoice>(`${this.baseUrl}/invoices/admin/submitToReview`, { invoices: invoiceIds }).pipe(\n      map((res) => {\n        this.fetchInvoices()\n        return res\n      })\n    )\n  }\n\n  submitInvoicesToQB(invoiceIds: string[]) {\n    return this.http.post<Invoice>(`${this.baseUrl}/invoices/admin/submitToQB`, { invoices: invoiceIds }).pipe(\n      map((res) => {\n        this.fetchInvoices()\n        return res\n      })\n    )\n  }\n\n  submitInvoicesToPaid(invoiceIds: string[]) {\n    return this.http.post<Invoice>(`${this.baseUrl}/invoices/admin/submitToPaid`, { invoices: invoiceIds }).pipe(\n      map((res) => {\n        this.fetchInvoices()\n        return res\n      })\n    )\n  }\n\n  exportToPdf(invoices: Invoice[]) {\n    return new Promise((resolve, reject) => {\n      this.http\n        .post(\n          `${this.baseUrl}/invoices/exportToPdf`,\n          { invoices: invoices.map((inv) => inv.id) },\n          {\n            responseType: 'arraybuffer',\n          }\n        )\n        .subscribe(\n          (data: any) => {\n            const blob = new Blob([data], { type: 'application/zip' })\n            const url = window.URL.createObjectURL(blob)\n            //window.open(url);\n            const link = document.createElement('a')\n            link.href = url\n            link.setAttribute('download', 'invoices.zip')\n            document.body.appendChild(link)\n            link.click()\n            resolve(true)\n          },\n          (err) => reject(false)\n        )\n    })\n  }\n}\n","import { NgModule } from \"@angular/core\";\nimport { CommonModule } from \"@angular/common\";\nimport { InvoiceComponent } from \"./invoice.component\";\nimport { RouterModule } from \"@angular/router\";\nimport { SharedModule } from \"../shared/shared.module\";\nimport { NewInvoiceDialogComponent } from \"./new-invoice-dialog/new-invoice-dialog.component\";\nimport { BillToDialogComponent } from \"./bill-to-dialog/bill-to-dialog.component\";\nimport { ShipSelectDialogComponent } from \"./ship-select-dialog/ship-select-dialog.component\";\nimport { MatExpansionModule } from \"@angular/material/expansion\";\nimport { AddVehicleDialogComponent } from \"./add-vehicle-dialog/add-vehicle-dialog.component\";\nimport { EditInvoiceDialogComponent } from \"./edit-invoice-dialog/edit-invoice-dialog.component\";\nimport { EditVehicleDialogComponent } from \"./edit-vehicle-dialog/edit-vehicle-dialog.component\";\n\nexport const routes = [\n  {\n    path: \"\",\n    component: InvoiceComponent,\n  },\n];\n\n@NgModule({\n  declarations: [\n    InvoiceComponent,\n    NewInvoiceDialogComponent,\n    BillToDialogComponent,\n    ShipSelectDialogComponent,\n    AddVehicleDialogComponent,\n    EditVehicleDialogComponent,\n    EditInvoiceDialogComponent,\n  ],\n  imports: [CommonModule, RouterModule.forChild(routes), SharedModule, MatExpansionModule],\n})\nexport class InvoiceModule {}","<h3>{{ data.type === \"TO\" ? \"Ship to\" : \"Ship from\" }}</h3>\n\n<div class=\"input-group pt-3\">\n  <div class=\"input-group-prepend\">\n    <span class=\"input-group-text\">\n      <i class=\"fas fa-search\"></i>\n    </span>\n  </div>\n  <input type=\"text\" class=\"form-control\" placeholder=\"Search customer...\" (input)=\"searchCustomers($event)\" />\n  <div class=\"w-100 text-secondary text-sm\">Min 3 characters</div>\n</div>\n\n<div class=\"w-100 my-3 table-wrapper table-responsive custom-scroll\">\n  <table class=\"table table-sm table-bordered\">\n    <thead>\n      <tr>\n        <th scope=\"col\">Customer list</th>\n      </tr>\n    </thead>\n    <tbody>\n      <div class=\"w-100 text-center\" *ngIf=\"!foundCustomers?.length\">\n        <p class=\"border py-2\">No customers found</p>\n      </div>\n      <tr *ngFor=\"let customer of foundCustomers\" (click)=\"onSelect(customer)\">\n        <td>{{ customer.name }}</td>\n      </tr>\n    </tbody>\n  </table>\n\n  <div class=\"flex-grow-1 bg-light quick-entry-btn py-1\">\n    <button class=\"w-100 btn btn-outline-primary\" (click)=\"onQuickEntry($event)\">+ Quick entry</button>\n  </div>\n</div>\n\n<!-- quick entry panel -->\n<form *ngIf=\"showQuickEntry\" class=\"py-2 mt-n4 mb-3 border-primary-1\" [formGroup]=\"customerForm\" (ngSubmit)=\"saveQuickEntry()\">\n  <div class=\"col-12 mb-3\">\n    <label for=\"name\" class=\"text-dark text-base\">Name</label>\n    <input\n      id=\"name\"\n      name=\"name\"\n      type=\"text\"\n      class=\"form-control\"\n      formControlName=\"name\"\n      [class.is-invalid]=\"customerForm.controls.name.touched && customerForm.controls.name.invalid\"\n    />\n    <div class=\"form-text invalid-feedback\" *ngIf=\"true\">Invalid field</div>\n  </div>\n\n  <div class=\"col-12 mb-3\">\n    <label for=\"state\" class=\"text-dark text-base\">State</label>\n    <div class=\"custom-select-wrapper\">\n      <select class=\"custom-select form-control\" (change)=\"onStateChange($event)\">\n        <option selected value=\"\">Select state...</option>\n        <option *ngFor=\"let state of states\" [value]=\"state.code\" [selected]=\"state.code === currentCity?.state_code\">\n          {{ state.name }}\n        </option>\n      </select>\n      <mat-icon class=\"half-arrow-icon\" svgIcon=\"half-arrow-down\"></mat-icon>\n    </div>\n  </div>\n\n  <div class=\"col-12 mb-3\">\n    <label for=\"city_id\" class=\"text-dark text-base\">City</label>\n    <div class=\"custom-select-wrapper\">\n      <select\n        class=\"custom-select form-control\"\n        formControlName=\"city_id\"\n        [class.is-invalid]=\"customerForm.controls.city_id.touched && customerForm.controls.city_id.invalid\"\n      >\n        <option *ngFor=\"let city of cities[selectedState]\" [value]=\"city.id\" [selected]=\"city.name === currentCity?.name\">\n          {{ city.name }}\n        </option>\n      </select>\n      <mat-icon class=\"half-arrow-icon\" svgIcon=\"half-arrow-down\"></mat-icon>\n    </div>\n  </div>\n\n  <div class=\"col-12\">\n    <button class=\"btn w-100 btn-success\" type=\"submit\">Save</button>\n  </div>\n</form>\n\n<div class=\"w-100 my-3 table-wrapper table-responsive custom-scroll\">\n  <table class=\"table table-sm table-bordered\">\n    <thead>\n      <tr>\n        <th scope=\"col\">Most recent</th>\n      </tr>\n    </thead>\n    <tbody>\n      <!-- <div class=\"w-100 text-center\">\n        <p class=\"border py-2\">No customers found</p>\n      </div> -->\n      <div class=\"w-100 text-center\" *ngIf=\"!mostRecentsCustomers?.length\">\n        <p class=\"border py-2\">No customers found</p>\n      </div>\n      <tr *ngFor=\"let customer of mostRecentsCustomers\" (click)=\"onSelect(customer)\">\n        <td>{{ customer.name }}</td>\n      </tr>\n    </tbody>\n  </table>\n</div>\n\n<div class=\"w-100 mt-3\">\n  <button class=\"w-100 btn btn-outline-primary\" (click)=\"backToInvoice()\">Back to invoice</button>\n</div>\n","import { Component, Inject, OnDestroy, OnInit } from \"@angular/core\";\nimport { FormBuilder, FormGroup, Validators } from \"@angular/forms\";\nimport { MatDialogRef, MAT_DIALOG_DATA } from \"@angular/material/dialog\";\nimport { Subscription } from \"rxjs\";\nimport { Customer, QuickEntryCustomer } from \"src/app/business/models/customer.models\";\nimport { City, CurrentCities, State } from \"src/app/business/models/geo.models\";\nimport { Invoice } from \"src/app/business/models/invoice.models\";\nimport { CustomerService } from \"src/app/business/services/customer.service\";\nimport { GeoService } from \"src/app/business/services/geo.service\";\nimport { InvoicesStateService } from \"src/app/business/state/invoice-state.service\";\nimport { regexs } from \"src/app/core/config/constants\";\n\nexport interface ShipSelectDialogData {\n  onBackToInvoice: (...args: any) => any;\n  //onCustomerQuickEntry: (...args: any) => any;\n  type: \"FROM\" | \"TO\";\n  action: \"new\" | \"edit\";\n}\n\n@Component({\n  selector: \"app-ship-select-dialog\",\n  templateUrl: \"./ship-select-dialog.component.html\",\n  styleUrls: [\"./ship-select-dialog.component.scss\"],\n})\nexport class ShipSelectDialogComponent implements OnInit, OnDestroy {\n  subscriptions: Subscription[] = [];\n  foundCustomers: Customer[] = [];\n  customerForm: FormGroup;\n  showQuickEntry = false;\n  states: State[] = [];\n  selectedState: string;\n  cities: CurrentCities = {};\n  selectedInvoice: Invoice;\n  currentCity;\n  mostRecentsCustomers: Customer[] = [];\n\n  constructor(\n    public dialogRef: MatDialogRef<ShipSelectDialogComponent>,\n    @Inject(MAT_DIALOG_DATA) public data: ShipSelectDialogData,\n    private fb: FormBuilder,\n    private invoicesState: InvoicesStateService,\n    private customerService: CustomerService,\n    private geoService: GeoService\n  ) {}\n\n  ngOnInit() {\n    this.buildForm();\n    this.states = this.geoService.states;\n    const sub = this.geoService.currentCities.subscribe((data) => {\n      this.cities = data;\n\n      if (this.currentCity) {\n        this.customerForm.controls.city_id.reset();\n        this.customerForm.controls.city_id.setValue(this.cities[this.selectedState]?.find((c) => c.name === this.currentCity.name)?.id);\n      }\n    });\n    this.subscriptions.push(sub);\n\n    //when invoice creating\n    if (this.data.action === \"new\") {\n      const sub2 = this.invoicesState.newInvoice$.subscribe((data) => this.handleEditQuickEntry(data));\n      this.subscriptions.push(sub2);\n    }\n\n    //when invoice updating\n    if (this.data.action === \"edit\") {\n      const sub2 = this.invoicesState.selectedInvoice$.subscribe((data) => this.handleEditQuickEntry(data));\n      this.subscriptions.push(sub2);\n    }\n\n    const sub3 = this.invoicesState.mostRecentsCustomers$.subscribe((data) => {\n      this.mostRecentsCustomers = data;\n    });\n    this.subscriptions.push(sub3);\n  }\n\n  handleEditQuickEntry(data) {\n    if (!data) return;\n    this.selectedInvoice = data as Invoice;\n\n    if (\n      (this.data.type === \"FROM\" && this.selectedInvoice?.quick_ship_from) ||\n      (this.data.type === \"TO\" && this.selectedInvoice?.quick_ship_to)\n    ) {\n      if (this.data.type === \"FROM\") {\n        this.currentCity = this.selectedInvoice?.quick_ship_from?.city;\n        this.selectedState = this.selectedInvoice?.quick_ship_from?.city.state_code;\n        this.customerForm.controls.name.setValue(this.selectedInvoice?.quick_ship_from?.name);\n      } else {\n        this.currentCity = this.selectedInvoice?.quick_ship_to?.city;\n        this.selectedState = this.selectedInvoice?.quick_ship_to?.city.state_code;\n        this.customerForm.controls.name.setValue(this.selectedInvoice?.quick_ship_to?.name);\n      }\n\n      this.geoService.fetchCitiesByState(this.selectedState);\n      this.customerForm.controls.city_id.reset();\n      this.customerForm.controls.city_id.setValue(this.cities[this.selectedState]?.find((c) => c.name === this.currentCity.name)?.id);\n      this.showQuickEntry = true;\n    }\n  }\n\n  private buildForm() {\n    this.customerForm = this.fb.group({\n      name: [\"\", [Validators.required]],\n      city_id: [\"\", [Validators.required]],\n    });\n  }\n\n  backToInvoice() {\n    this.data.onBackToInvoice();\n  }\n\n  async searchCustomers(e: any) {\n    const query = e.target.value;\n    this.foundCustomers = await this.customerService.searchCustomers(query);\n  }\n\n  onSelect(customer: Customer | QuickEntryCustomer, isQuickEntry = false) {\n    const setInvoice =\n      this.data.action === \"new\" ? (data) => this.invoicesState.setNewInvoice(data) : (data) => this.invoicesState.setSelectedInvoice(data);\n    const isFrom = this.data.type === \"FROM\";\n    if (isQuickEntry) {\n      setInvoice({\n        [isFrom ? \"quick_ship_from\" : \"quick_ship_to\"]: customer,\n        [isFrom ? \"ship_from\" : \"ship_to\"]: null,\n      });\n    } else {\n      setInvoice({\n        [isFrom ? \"ship_from\" : \"ship_to\"]: customer,\n        [isFrom ? \"quick_ship_from\" : \"quick_ship_to\"]: null,\n      });\n    }\n    this.data.onBackToInvoice();\n  }\n\n  onQuickEntry(event: any) {\n    event.target.blur();\n    this.customerForm.reset();\n    this.showQuickEntry = !this.showQuickEntry;\n  }\n\n  onStateChange(event: any) {\n    this.selectedState = event.target.value;\n    this.geoService.fetchCitiesByState(this.selectedState);\n    this.customerForm.controls.city_id.reset();\n  }\n\n  saveQuickEntry() {\n    if (this.customerForm.invalid) {\n      return Object.values(this.customerForm.controls).forEach((control) => {\n        if (control instanceof FormGroup) {\n          Object.values(control.controls).forEach((control) => control.markAsTouched());\n        } else {\n          control.markAsTouched();\n        }\n      });\n    } else {\n      //save customer\n      const selectedCity: City = this.cities[this.selectedState]?.find((c) => c.id === this.customerForm.controls.city_id.value);\n      const body = {\n        name: this.customerForm.controls.name.value,\n        city: {\n          name: selectedCity?.name,\n          state: selectedCity?.state_name,\n          state_code: selectedCity?.state_code,\n        },\n      };\n\n      this.onSelect(body, true);\n    }\n  }\n\n  ngOnDestroy() {\n    this.subscriptions.forEach((sub) => sub.unsubscribe());\n  }\n}\n"]}